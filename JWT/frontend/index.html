<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8" />
    <title>JWT Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app">
    <h2 v-if="!token">Login</h2>

    <div v-if="!token">
        <input v-model="username" placeholder="username"><br>
        <input v-model="password" type="password" placeholder="password"><br><br>

        <button @click="login">Login</button>
        <button @click="signup">Signup</button>
        <p>{{ message }}</p>
    </div>

    <div v-else>
        <h2>Home</h2>
        <button @click="loadHome">Uƒçitaj Home</button>
        <button @click="logout">Logout</button>
        <p>{{ homeMessage }}</p>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            username: "",
            password: "",
            message: "",
            homeMessage: "",
            token: localStorage.getItem("token")
        };
    },
    methods: {
        async signup() {
            const res = await fetch("http://localhost:3000/signup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username: this.username,
                    password: this.password
                })
            });

            const data = await res.json();
            this.message = data.message;
        },

        async login() {
            const res = await fetch("http://localhost:3000/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username: this.username,
                    password: this.password
                })
            });

            const data = await res.json();

            if (data.token) {
                this.token = data.token;
                localStorage.setItem("token", data.token);
                this.message = "";
            } else {
                this.message = data.message;
            }
        },

        async loadHome() {
            const res = await fetch("http://localhost:3000/home", {
                headers: {
                    Authorization: "Bearer " + this.token
                }
            });

            const data = await res.json();
            this.homeMessage = data.message;
        },

        logout() {
            localStorage.removeItem("token");
            this.token = null;
            this.homeMessage = "";
        }
    }
}).mount("#app");
</script>
</body>
</html>
